<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Forum | Gwinnett County Resource Hub</title>
    <link rel="icon" type="image/png" href="../favicon-gwinnett.png">

    <!-- Use your main site theme -->
    <link rel="stylesheet" href="../styles.css">

    <!-- Forum-specific styles -->
    <style>
        /* Layout wrapper */
        
        .forum-wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 18px 14px 40px;
        }
        /* Forum header row */
        
        .forum-top {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-top: 12px;
            margin-bottom: 14px;
        }
        
        .forum-title {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--sandText);
        }
        
        .forum-subtitle {
            margin: 6px 0 0;
            color: var(--mutedText);
            max-width: 70ch;
        }
        
        .forum-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn {
            appearance: none;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, .06);
            color: var(--sandText);
            padding: 10px 14px;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 650;
            transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, .10);
            border-color: rgba(176, 109, 76, .55);
            transform: translateY(-1px);
        }
        
        .btn.primary {
            background: rgba(176, 109, 76, .92);
            border-color: rgba(255, 255, 255, .16);
            color: white;
        }
        
        .btn.primary:hover {
            background: rgba(47, 91, 59, .92);
            border-color: rgba(255, 255, 255, .22);
        }
        /* Filter + search bar */
        
        .forum-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin: 12px 0 18px;
            padding: 12px;
            border-radius: 16px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, .04);
        }
        
        .field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .field label {
            font-size: .85rem;
            color: var(--mutedText);
            font-weight: 600;
        }
        
        .input,
        .select,
        .textarea {
            background: rgba(255, 255, 255, .04);
            border: 1px solid var(--border);
            color: var(--sandText);
            border-radius: 14px;
            padding: 10px 12px;
            outline: none;
            font-size: .98rem;
            min-width: 220px;
        }
        
        .input::placeholder,
        .textarea::placeholder {
            color: rgba(233, 225, 214, .55);
        }
        
        .textarea {
            min-width: unset;
            width: 100%;
            min-height: 120px;
            resize: vertical;
            line-height: 1.35;
        }
        /* Forum list */
        
        .thread-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .thread {
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, .04);
            border-radius: 18px;
            overflow: hidden;
        }
        
        .thread-header {
            padding: 14px 14px 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: flex-start;
            justify-content: space-between;
        }
        
        .thread-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(36, 64, 46, .55);
            border: 1px solid rgba(233, 225, 214, .16);
            color: var(--sandText);
            font-size: .85rem;
            font-weight: 700;
            width: fit-content;
        }
        
        .thread-title {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 750;
            color: var(--sandText);
        }
        
        .thread-byline {
            font-size: .9rem;
            color: var(--mutedText);
        }
        
        .thread-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .thread-body {
            padding: 0 14px 14px;
            color: rgba(255, 255, 255, .88);
            line-height: 1.45;
            white-space: pre-wrap;
        }
        /* Replies */
        
        .replies {
            border-top: 1px solid var(--border);
            background: rgba(0, 0, 0, .10);
            padding: 12px 14px 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .reply {
            border: 1px solid rgba(233, 225, 214, .10);
            background: rgba(255, 255, 255, .03);
            border-radius: 14px;
            padding: 10px 12px;
        }
        
        .reply-top {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 6px;
        }
        
        .reply-name {
            font-weight: 750;
            color: var(--sandText);
            font-size: .95rem;
        }
        
        .reply-time {
            color: rgba(233, 225, 214, .65);
            font-size: .85rem;
        }
        
        .reply-text {
            margin: 0;
            color: rgba(255, 255, 255, .86);
            line-height: 1.35;
            white-space: pre-wrap;
        }
        /* Empty state */
        
        .empty {
            border: 1px dashed rgba(233, 225, 214, .25);
            background: rgba(255, 255, 255, .03);
            border-radius: 18px;
            padding: 18px;
            color: var(--mutedText);
            text-align: center;
        }
        /* Modal */
        
        .modal-scrim {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .65);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 90;
            padding: 16px;
        }
        
        .modal-scrim.open {
            display: flex;
        }
        
        .modal {
            width: min(720px, 96vw);
            background: var(--soil);
            border: 1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .modal-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-head h3 {
            margin: 0;
            font-size: 1.05rem;
            color: var(--sandText);
        }
        
        .modal-body {
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .modal-foot {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 12px 14px;
            border-top: 1px solid var(--border);
            background: rgba(255, 255, 255, .02);
        }
        
        .btn.ghost {
            background: rgba(255, 255, 255, .04);
            color: var(--sandText);
        }
        
        @media (max-width: 720px) {
            .row {
                grid-template-columns: 1fr;
            }
            .input,
            .select {
                min-width: unset;
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <!-- Topbar (simple version without sidebar to keep it focused) -->
    <header class="topbar">
        <a class="brand-pill" href="../index.html" aria-label="Go to home">
            <span class="brand-dot" aria-hidden="true">GC</span>
            <span>Community Hub</span>
        </a>
        <h1 class="site-title">Gwinnett County Resource Hub</h1>
        <button class="menu-btn" id="menuBtn" aria-label="Open menu">
            <span class="burger" id="burgerIcon"></span>
        </button>
    </header>

    <div class="scrim" id="scrim" hidden></div>

    <aside class="sidebar" id="sidebar" aria-hidden="true">
        <div class="sidebar-header">
            <h2>Menu</h2>
            <button class="close-btn" id="closeBtn" aria-label="Close menu">X</button>
        </div>

        <nav class="side-nav">
            <a class="nav-item" href="../index.html">Home</a>
            <button class="nav-item drop-btn" data-drop="connecting" aria-expanded="false">
                Connecting <span>v</span>
            </button>

            <div class="drop-panel" id="connecting">
                <a class="nav-sub" href="../Connecting/forum.html">Forum</a>
                <a class="nav-sub" href="../Connecting/scholarship.html">Scholarships</a>
                <a class="nav-sub" href="../Connecting/tutoring.html">Tutoring</a>
            </div>

            <button class="nav-item drop-btn" data-drop="countywide" aria-expanded="false">
                County-Wide <span>v</span>
            </button>

            <div class="drop-panel" id="countywide">
                <a class="nav-sub" href="../County-Wide/activities.html">Activities</a>
                <a class="nav-sub" href="../County-Wide/awards.html">Awards</a>
                <a class="nav-sub" href="../County-Wide/news.html">News</a>
            </div>

            <a class="nav-item" href="../mentalhealth.html">Emotional / Mental Programs</a>
            <a class="nav-item" href="../feedback.html">Feedback Form</a>
            <a class="nav-item" href="references.html">References</a>
        </nav>
    </aside>

    <main class="forum-wrap">
        <div class="forum-top">
            <div>
                <h2 class="forum-title">Student Forum (Demo)</h2>
                <p class="forum-subtitle">
                    This forum is a local demo. Posts and replies are saved to your browser only.
                </p>
            </div>

            <div class="forum-actions">
                <button class="btn" id="clearBtn" type="button">Clear</button>
                <button class="btn primary" id="newPostBtn" type="button">+ New Post</button>
            </div>
        </div>

        <div class="forum-filters">
            <div class="field">
                <label for="subjectFilter">Filter by subject</label>
                <select class="select" id="subjectFilter">
          <option value="All">All</option>
          <option value="Scholarships">Scholarships</option>
          <option value="Activities">Activities</option>
          <option value="Tutoring">Tutoring</option>
          <option value="Awards">Awards</option>
          <option value="News">News</option>
          <option value="Mental Health">Mental Health</option>
          <option value="General">General</option>
        </select>
            </div>

            <div class="field" style="flex:1; min-width: 240px;">
                <label for="searchBox">Search</label>
                <input class="input" id="searchBox" placeholder="Search titles or content..." />
            </div>
        </div>

        <div id="threads" class="thread-list"></div>
        <div id="empty" class="empty" hidden>
            No posts yet. Click <b>New Post</b> to create the first thread.
        </div>
    </main>

    <!-- New Post Modal -->
    <div class="modal-scrim" id="postModalScrim" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="postModalTitle">
            <div class="modal-head">
                <h3 id="postModalTitle">Create a Post</h3>
                <button class="btn ghost" id="closePostModal" type="button">✕</button>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="field">
                        <label for="postName">Name</label>
                        <input class="input" id="postName" placeholder="e.g., Alex" maxlength="30">
                    </div>
                    <div class="field">
                        <label for="postSubject">Subject</label>
                        <select class="select" id="postSubject">
              <option value="Scholarships">Scholarships</option>
              <option value="Activities">Activities</option>
              <option value="Tutoring">Tutoring</option>
              <option value="Awards">Awards</option>
              <option value="News">News</option>
              <option value="Mental Health">Mental Health</option>
              <option value="General">General</option>
            </select>
                    </div>
                </div>

                <div class="field">
                    <label for="postTitle">Title</label>
                    <input class="input" id="postTitle" placeholder="Short summary of your post..." maxlength="80">
                </div>

                <div class="field">
                    <label for="postBody">Message</label>
                    <textarea class="textarea" id="postBody" placeholder="Type your message..."></textarea>
                </div>
            </div>

            <div class="modal-foot">
                <button class="btn ghost" id="cancelPost" type="button">Cancel</button>
                <button class="btn primary" id="submitPost" type="button">Post</button>
            </div>
        </div>
    </div>

    <!-- Reply Modal -->
    <div class="modal-scrim" id="replyModalScrim" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="replyModalTitle">
            <div class="modal-head">
                <h3 id="replyModalTitle">Reply</h3>
                <button class="btn ghost" id="closeReplyModal" type="button">✕</button>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="field">
                        <label for="replyName">Name</label>
                        <input class="input" id="replyName" placeholder="e.g., Jordan" maxlength="30">
                    </div>
                    <div class="field">
                        <label>Replying to</label>
                        <input class="input" id="replyToTitle" disabled>
                    </div>
                </div>

                <div class="field">
                    <label for="replyBody">Message</label>
                    <textarea class="textarea" id="replyBody" placeholder="Write your reply..."></textarea>
                </div>
            </div>

            <div class="modal-foot">
                <button class="btn ghost" id="cancelReply" type="button">Cancel</button>
                <button class="btn primary" id="submitReply" type="button">Reply</button>
            </div>
        </div>
    </div>

    <script>
        // ===== Local "Forum" (demo) with localStorage =====

        const STORAGE_KEY = "gc_resourcehub_forum_threads_v1";

        /** Thread shape:
         * {
         *   id, name, subject, title, body, createdAt,
         *   replies: [{ id, name, body, createdAt }]
         * }
         */

        const threadsEl = document.getElementById("threads");
        const emptyEl = document.getElementById("empty");

        const subjectFilter = document.getElementById("subjectFilter");
        const searchBox = document.getElementById("searchBox");

        // Post modal elements
        const postModalScrim = document.getElementById("postModalScrim");
        const newPostBtn = document.getElementById("newPostBtn");
        const closePostModal = document.getElementById("closePostModal");
        const cancelPost = document.getElementById("cancelPost");
        const submitPost = document.getElementById("submitPost");

        const postName = document.getElementById("postName");
        const postSubject = document.getElementById("postSubject");
        const postTitle = document.getElementById("postTitle");
        const postBody = document.getElementById("postBody");

        // Reply modal elements
        const replyModalScrim = document.getElementById("replyModalScrim");
        const closeReplyModal = document.getElementById("closeReplyModal");
        const cancelReply = document.getElementById("cancelReply");
        const submitReply = document.getElementById("submitReply");

        const replyName = document.getElementById("replyName");
        const replyBody = document.getElementById("replyBody");
        const replyToTitle = document.getElementById("replyToTitle");

        const clearBtn = document.getElementById("clearBtn");

        let threads = loadThreads();
        let replyingToThreadId = null;

        function uid() {
            return Math.random().toString(16).slice(2) + Date.now().toString(16);
        }

        function formatTime(ms) {
            const d = new Date(ms);
            return d.toLocaleString([], {
                year: "numeric",
                month: "short",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit"
            });
        }

        function makeSeedThreads() {
            const now = Date.now();
            return [{
                id: uid(),
                name: "Ari (GCPS Senior)",
                subject: "Scholarships",
                title: "Any local scholarships still open this month?",
                body: "I already checked HOPE and Zell Miller. I need local options for students interested in nursing.",
                createdAt: now - 1000 * 60 * 60 * 22,
                replies: [{
                    id: uid(),
                    name: "Ms. Lopez (Counselor)",
                    body: "Check the GCPS Foundation catalog and Gwinnett Tech Foundation list. Both have rolling and term-based options.",
                    createdAt: now - 1000 * 60 * 60 * 20
                }, {
                    id: uid(),
                    name: "Jayden",
                    body: "Peach State FCU also had one posted this cycle. Deadline is usually in late winter.",
                    createdAt: now - 1000 * 60 * 60 * 18
                }]
            }, {
                id: uid(),
                name: "Nia",
                subject: "Tutoring",
                title: "Best SAT prep resources in Gwinnett?",
                body: "Looking for affordable SAT prep with weekend options.",
                createdAt: now - 1000 * 60 * 60 * 15,
                replies: [{
                    id: uid(),
                    name: "Forum Mod",
                    body: "Check the Tutoring page filters and search SAT/ACT. There are demo listings you can compare by price.",
                    createdAt: now - 1000 * 60 * 60 * 14
                }]
            }, {
                id: uid(),
                name: "Marcus",
                subject: "Activities",
                title: "Community service events this weekend?",
                body: "Need 6 volunteer hours. Any events from the county calendar that are student-friendly?",
                createdAt: now - 1000 * 60 * 60 * 10,
                replies: []
            }];
        }

        function loadThreads() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) {
                    const seeded = makeSeedThreads();
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded));
                    return seeded;
                }
                const parsed = JSON.parse(raw);
                if (!Array.isArray(parsed) || parsed.length === 0) {
                    const seeded = makeSeedThreads();
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded));
                    return seeded;
                }
                return parsed;
            } catch {
                const seeded = makeSeedThreads();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded));
                return seeded;
            }
        }

        function saveThreads() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(threads));
        }

        function openModal(scrimEl) {
            scrimEl.classList.add("open");
            scrimEl.setAttribute("aria-hidden", "false");
        }

        function closeModal(scrimEl) {
            scrimEl.classList.remove("open");
            scrimEl.setAttribute("aria-hidden", "true");
        }

        function clearPostModal() {
            postName.value = "";
            postTitle.value = "";
            postBody.value = "";
            postSubject.value = "Scholarships";
        }

        function clearReplyModal() {
            replyName.value = "";
            replyBody.value = "";
            replyToTitle.value = "";
            replyingToThreadId = null;
        }

        function render() {
            const filter = subjectFilter.value;
            const query = (searchBox.value || "").trim().toLowerCase();

            let visible = [...threads];

            if (filter !== "All") {
                visible = visible.filter(t => t.subject === filter);
            }

            if (query) {
                visible = visible.filter(t =>
                    (t.title || "").toLowerCase().includes(query) ||
                    (t.body || "").toLowerCase().includes(query) ||
                    (t.name || "").toLowerCase().includes(query)
                );
            }

            // newest first
            visible.sort((a, b) => b.createdAt - a.createdAt);

            threadsEl.innerHTML = "";

            if (visible.length === 0) {
                emptyEl.hidden = threads.length !== 0; // show empty only when no posts at all
            } else {
                emptyEl.hidden = true;
            }

            visible.forEach(thread => {
                        const threadDiv = document.createElement("div");
                        threadDiv.className = "thread";

                        threadDiv.innerHTML = `
          <div class="thread-header">
            <div class="thread-meta">
              <div class="badge">${escapeHtml(thread.subject)}</div>
              <h3 class="thread-title">${escapeHtml(thread.title)}</h3>
              <div class="thread-byline">Posted by <b>${escapeHtml(thread.name)}</b> • ${formatTime(thread.createdAt)}</div>
            </div>

            <div class="thread-actions">
              <button class="btn" data-action="reply" data-id="${thread.id}" type="button">Reply</button>
            </div>
          </div>

          <div class="thread-body">${escapeHtml(thread.body)}</div>

          <div class="replies" ${thread.replies.length ? "" : 'style="opacity:.88;"'}>
            ${thread.replies.length ? thread.replies.map(r => `
              <div class="reply">
                <div class="reply-top">
                  <div class="reply-name">${escapeHtml(r.name)}</div>
                  <div class="reply-time">${formatTime(r.createdAt)}</div>
                </div>
                <p class="reply-text">${escapeHtml(r.body)}</p>
              </div>
            `).join("") : `<div style="color: rgba(233,225,214,.68); font-size:.92rem;">No replies yet. Be the first to reply.</div>`}
          </div>
        `;

        threadsEl.appendChild(threadDiv);
      });
    }

    // Basic HTML escaping (prevents broken layout from user text)
    function escapeHtml(str){
      return String(str || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // ===== Events =====

    newPostBtn.addEventListener("click", () => {
      clearPostModal();
      openModal(postModalScrim);
      postName.focus();
    });

    function closePost(){
      closeModal(postModalScrim);
    }

    closePostModal.addEventListener("click", closePost);
    cancelPost.addEventListener("click", closePost);
    postModalScrim.addEventListener("click", (e) => {
      if (e.target === postModalScrim) closePost();
    });

    submitPost.addEventListener("click", () => {
      const name = postName.value.trim() || "Anonymous";
      const subject = postSubject.value;
      const title = postTitle.value.trim();
      const body = postBody.value.trim();

      if (!title){
        alert("Please add a title.");
        postTitle.focus();
        return;
      }
      if (!body){
        alert("Please type a message.");
        postBody.focus();
        return;
      }

      const newThread = {
        id: uid(),
        name,
        subject,
        title,
        body,
        createdAt: Date.now(),
        replies: []
      };

      threads.push(newThread);
      saveThreads();
      closePost();
      render();
    });

    // Click Reply button on a thread
    threadsEl.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-action='reply']");
      if (!btn) return;

      const id = btn.getAttribute("data-id");
      const thread = threads.find(t => t.id === id);
      if (!thread) return;

      clearReplyModal();
      replyingToThreadId = id;
      replyToTitle.value = thread.title;

      openModal(replyModalScrim);
      replyName.focus();
    });

    function closeReply(){
      closeModal(replyModalScrim);
    }

    closeReplyModal.addEventListener("click", closeReply);
    cancelReply.addEventListener("click", closeReply);
    replyModalScrim.addEventListener("click", (e) => {
      if (e.target === replyModalScrim) closeReply();
    });

    submitReply.addEventListener("click", () => {
      const name = replyName.value.trim() || "Anonymous";
      const body = replyBody.value.trim();

      if (!replyingToThreadId) return;
      if (!body){
        alert("Please type a reply.");
        replyBody.focus();
        return;
      }

      const thread = threads.find(t => t.id === replyingToThreadId);
      if (!thread) return;

      thread.replies.push({
        id: uid(),
        name,
        body,
        createdAt: Date.now()
      });

      saveThreads();
      closeReply();
      render();
    });

    subjectFilter.addEventListener("change", render);
    searchBox.addEventListener("input", render);

    clearBtn.addEventListener("click", () => {
      const ok = confirm("Clear all demo posts and replies on this device?");
      if (!ok) return;
      threads = [];
      saveThreads();
      render();
    });

    // Escape closes modals
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape"){
        closePost();
        closeReply();
      }
    });

    // Initial render
    render();
    </script>
    <script src="../menu.js"></script>
</body>

</html>